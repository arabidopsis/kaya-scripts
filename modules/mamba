#%Module

proc ModulesHelp {} {
    puts stderr "setup a conda environment [uname machine]."

}
# for module whatis
module-whatis "setup a conda environment"

# we set up micromamba to place MAMBA_ROOT_PREFIX here...
set MAMBA_ROOT_PREFIX "/group/peb007/micromamba"
# set CONDA_DEFAULT_ENV (name) in slurm file
set myenv "[getenv CONDA_DEFAULT_ENV]"
if { $myenv == "_UNDEFINED_" } {
    reportError "missing \"export CONDA_DEFAULT_ENV=<environment>\" in slurm script"
    exit 1
}
# these are the environment and PATH variables that 
# `$MAMBA_EXE shell activate py312 --shell bash`
# returns
setenv CONDA_PREFIX "${MAMBA_ROOT_PREFIX}/envs/${myenv}"
setenv CONDA_SHLVL "1"
setenv CONDA_DEFAULT_ENV "${myenv}"
setenv CONDA_PROMPT_MODIFIER "(${myenv}) "

prepend-path PATH "${MAMBA_ROOT_PREFIX}/envs/${myenv}/bin"
